<svg width="1000" height="1300" xmlns="http://www.w3.org/2000/svg" font-family="sans-serif">
    <!-- Definitions for markers and styles -->
    <defs>
        <marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5"
            markerWidth="6" markerHeight="6"
            orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#333" />
        </marker>
        <style>
            .block {
                fill: #f0f4f8;
                stroke: #607d8b;
                stroke-width: 2;
                rx: 8;
                ry: 8;
            }
            .decision {
                fill: #fff8e1;
                stroke: #ffc107;
            }
            .io {
                fill: #e0f7fa;
                stroke: #00acc1;
                stroke-dasharray: 5,5;
            }
            .start-end {
                fill: #e8f5e9;
                stroke: #4caf50;
                rx: 20;
                ry: 20;
            }
            .connector {
                stroke: #333;
                stroke-width: 2;
                marker-end: url(#arrow);
                fill: none;
            }
            .text {
                font-size: 14px;
                text-anchor: middle;
                dominant-baseline: central;
                fill: #212121;
            }
            .label {
                font-size: 12px;
                font-style: italic;
                fill: #555;
            }
        </style>
    </defs>

    <!-- Title -->
    <text x="500" y="30" font-size="24" font-weight="bold" text-anchor="middle">Trading Cycle Logic</text>
    <text x="500" y="55" font-size="16" text-anchor="middle">Based on src/trading/trading_cycle.py</text>

    <!-- Blocks -->
    <g id="start">
        <rect x="400" y="100" width="200" height="40" class="start-end" />
        <text x="500" y="120" class="text">Start Cycle</text>
    </g>

    <g id="get_position">
        <rect x="375" y="180" width="250" height="60" class="io" />
        <text x="500" y="210" class="text">
            <tspan x="500" dy="-0.6em">Get Current Position</tspan>
            <tspan x="500" dy="1.2em"><i>(_get_current_position)</i></tspan>
        </text>
    </g>

    <g id="check_pending">
        <rect x="375" y="280" width="250" height="60" class="block decision" />
        <text x="500" y="310" class="text">Is there a PENDING order?</text>
    </g>

    <g id="check_status">
        <rect x="650" y="280" width="250" height="60" class="block" />
        <text x="775" y="310" class="text">
            <tspan x="775" dy="-0.6em">Check Actual Order Status</tspan>
            <tspan x="775" dy="1.2em"><i>(oms.get_order_status)</i></tspan>
        </text>
    </g>

    <g id="status_changed">
        <rect x="650" y="380" width="250" height="60" class="block decision" />
        <text x="775" y="410" class="text">Has status changed?</text>
    </g>

    <g id="update_log">
        <rect x="650" y="480" width="250" height="60" class="io" />
        <text x="775" y="510" class="text">
            <tspan x="775" dy="-0.6em">Update Log with New Status</tspan>
            <tspan x="775" dy="1.2em"><i>(_update_log)</i></tspan>
        </text>
    </g>

    <g id="end_sync">
        <rect x="675" y="580" width="200" height="40" class="start-end" />
        <text x="775" y="600" class="text">End Cycle (Synced)</text>
    </g>

    <g id="get_market_data">
        <rect x="375" y="380" width="250" height="60" class="block" />
        <text x="500" y="410" class="text">
            <tspan x="500" dy="-0.6em">Get Market Data</tspan>
            <tspan x="500" dy="1.2em"><i>(market_data_service)</i></tspan>
        </text>
    </g>

    <g id="get_ai_decision">
        <rect x="375" y="480" width="250" height="60" class="block" />
        <text x="500" y="510" class="text">
            <tspan x="500" dy="-0.6em">Get AI Decision</tspan>
            <tspan x="500" dy="1.2em"><i>(_get_ai_decision)</i></tspan>
        </text>
    </g>

    <g id="check_decision">
        <rect x="375" y="580" width="250" height="60" class="block decision" />
        <text x="500" y="610" class="text">Decision is BUY?</text>
    </g>

    <g id="place_order">
        <rect x="375" y="680" width="250" height="60" class="block" />
        <text x="500" y="710" class="text">
            <tspan x="500" dy="-0.6em">Place Order</tspan>
            <tspan x="500" dy="1.2em"><i>(oms.place_order)</i></tspan>
        </text>
    </g>

    <g id="log_new_order">
        <rect x="375" y="780" width="250" height="60" class="io" />
        <text x="500" y="810" class="text">
            <tspan x="500" dy="-0.6em">Log New Order as PENDING</tspan>
            <tspan x="500" dy="1.2em"><i>(_update_log)</i></tspan>
        </text>
    </g>
    
    <g id="check_sell">
        <rect x="100" y="580" width="250" height="60" class="block decision" />
        <text x="225" y="610" class="text">Decision is SELL?</text>
    </g>
    
    <g id="sell_logic">
        <rect x="100" y="680" width="250" height="60" class="block" />
        <text x="225" y="710" class="text">
            <tspan x="225" dy="-0.6em">Execute Sell Logic</tspan>
            <tspan x="225" dy="1.2em"><i>(Future Implementation)</i></tspan>
        </text>
    </g>

    <g id="end_main">
        <rect x="400" y="880" width="200" height="40" class="start-end" />
        <text x="500" y="900" class="text">End Cycle</text>
    </g>

    <!-- Connectors -->
    <path class="connector" d="M 500 140 V 180" />
    <path class="connector" d="M 500 240 V 280" />
    <path class="connector" d="M 625 310 H 650" />
    <text x="637" y="300" class="label">Yes</text>
    <path class="connector" d="M 775 340 V 380" />
    <path class="connector" d="M 775 440 V 480" />
    <text x="790" y="465" class="label">Yes</text>
    <path class="connector" d="M 775 540 V 580" />
    <path class="connector" d="M 500 340 V 380" />
    <text x="485" y="360" class="label">No</text>
    <path class="connector" d="M 500 440 V 480" />
    <path class="connector" d="M 500 540 V 580" />
    <path class="connector" d="M 500 640 V 680" />
    <text x="515" y="660" class="label">Yes</text>
    <path class="connector" d="M 500 740 V 780" />
    <path class="connector" d="M 500 840 V 880" />
    <path class="connector" d="M 375 610 H 350 V 595 H 100" />
    <text x="360" y="600" class="label">No</text>
    <path class="connector" d="M 225 640 V 680" />
    <text x="240" y="660" class="label">Yes</text>
    <path class="connector" d="M 225 740 V 890 H 400" />
    <path class="connector" d="M 100 610 H 50 V 900 H 400" />
    <text x="85" y="600" class="label">No (HOLD)</text>
    <path class="connector" d="M 650 410 H 630 V 890 H 400" />
    <text x="635" y="420" class="label">No</text>
</svg>