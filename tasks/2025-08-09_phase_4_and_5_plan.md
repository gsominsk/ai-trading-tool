# План Работ по состоянию на 2025-08-09

Этот документ описывает согласованный план работ, разделенный на две фазы.

---

### --- ФАЗА 4: Рефакторинг TradingCycle ---

**Цель:** Улучшить архитектуру `TradingCycle`, отделив логику работы с файлами и улучшив логирование.

**Задачи:**
- [ ] 4.1: Создать пустой файл `src/trading/log_repository.py`.
- [ ] 4.2: Реализовать класс `TradeLogRepository` в `src/trading/log_repository.py`.
- [ ] 4.3: Создать файл юнит-теста `tests/unit/trading/test_log_repository.py`.
- [ ] 4.4: Написать юнит-тесты для `TradeLogRepository`.
- [ ] 4.5: Запустить тесты для `TradeLogRepository` и убедиться в их успешном прохождении.
- [ ] 4.6: Провести рефакторинг `TradingCycle` для внедрения зависимости `TradeLogRepository`.
- [ ] 4.7: Заменить прямую работу с файлом `trade_log.csv` в `TradingCycle` на вызовы методов репозитория.
- [ ] 4.8: Заменить все вызовы `print()` в `TradingCycle` на структурированное логирование.
- [ ] 4.9: Улучшить обработку ошибок в `TradingCycle`, заменив общие `except Exception`.
- [ ] 4.10: Обновить интеграционные тесты для отражения новых изменений в `TradingCycle`.
- [ ] 4.11: Запустить полный набор тестов (юнит и интеграционные).
- [ ] 4.12: Обновить Memory Bank, задокументировав завершение Фазы 4.

---

### --- ФАЗА 5: Исправление Системы Трассировки ---

**Цель:** Решить критический архитектурный недостаток в системе логирования для обеспечения возможности отладки и поддержки.

**Задачи:**
- [ ] 5.1: Провести рефакторинг `TraceGenerator` для поддержки иерархической трассировки (передача `parent_trace_id`).
- [ ] 5.2: Модифицировать `MarketDataService` для сквозной передачи `trace_id` во все дочерние операции (`_get_klines`, `_calculate_rsi` и т.д.).
- [ ] 5.3: Создать/обновить юнит-тесты для `TraceGenerator` для проверки корректности генерации иерархических ID.
- [ ] 5.4: Создать/обновить интеграционные тесты для `MarketDataService`, чтобы убедиться, что в логах полная цепочка операций имеет один и тот же корневой `trace_id`.
- [ ] 5.5: Запустить все тесты.
- [ ] 5.6: Обновить Memory Bank, задокументировав завершение Фазы 5.